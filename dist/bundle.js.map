{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/document.js","webpack:///./src/editable.js","webpack:///./src/index.js","webpack:///./src/markdown_document.js"],"names":["Document","offset","styles","styleName","i","ranges","length","range","start","end","push","value","historyItem","type","history","beforeInsert","arr","Array","from","text","splice","join","fireUpdate","insert","n","dir","beforeDelete","event","callback","listeners","data","callbacks","forEach","allRanges","nodes","lines","result","style","getStylesAtOffset","filter","rangeData","map","stylesEqual","a","b","el","indexOf","currentNode","currentLine","ch","x","lineText","lineLength","node","openTag","closeTag","replace","Editable","setAttribute","addEventListener","focus","io","lastSelection","innerHTML","toHtml","insertText","collapsed","cursorPos","startOffset","setCursorPos","endOffset","stylesOverride","mark","unmark","e","preventDefault","clipboardData","window","pastedData","getData","getSelection","inputType","ctrlKey","key","slice","firstIndex","regexp","match","matches","matchAll","index","navigationKeys","getCursorPos","getRangeAt","startContainer","parentElement","classList","contains","cb","__cursorPosListeners","container","childNodes","nodeName","flat","Infinity","lastNode","firstChild","line","containerData","getContainerAtOffset","setEnd","setStart","caretOffset","selected","toString","preCaretRange","cloneRange","selectNodeContents","endContainer","brCount","cloneContents","querySelectorAll","firstOffset","getContainerOffset","secondOffset","__cursorPos","val","setTimeout","HTMLElement","customElements","define","BakaEditor","name","oldValue","newValue","elms","placeholder","outputContainer","document","querySelector","getAttribute","template","wrapper","editor","onTextUpdate","bind","logger","initEditor","initButtons","Object","keys","getStylesAtRange","remove","buttons","add","addCursorPosListener","updateButtons","bold","italic","strike","underline","monospace","onButtonClick","buttonName","button","isActive","historyEvent","debug","console","log","toUpperCase","html","initIO","MarkdownDocument","t","service","process","styleNames","fullMatch"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","export default class Document {\r\n    //    text = 'aabb\\nbbaa'\r\n    text = ''\r\n    history = []\r\n\r\n    getStylesAtOffset(offset) {\r\n        let styles = {}\r\n        for (let styleName in this.styles) {\r\n            for (let i = 0; i < this.styles[styleName].ranges.length; i++) {\r\n                let range = this.styles[styleName].ranges[i]\r\n                if (!(range[0] < offset && range[1] >= offset)) continue\r\n                styles[styleName] = range\r\n            }\r\n        }\r\n        return styles\r\n    }\r\n\r\n    getStylesAtRange(start, end) {\r\n        let styles = []\r\n        for (let styleName in this.styles) {\r\n            for (let i = 0; i < this.styles[styleName].ranges.length; i++) {\r\n                let range = this.styles[styleName].ranges[i]\r\n                if (\r\n                    !(\r\n                        (\r\n                            (range[0] >= start && range[0] < end) || // Начало в выделении\r\n                            (range[1] > start && range[1] <= end) || // Конец в выделении\r\n                            (range[0] <= start && range[1] >= end)\r\n                        ) // Выделение между началом и концом\r\n                    )\r\n                )\r\n                    continue\r\n                styles.push(styleName)\r\n            }\r\n        }\r\n        return styles\r\n    }\r\n\r\n    beforeInsert() {}\r\n\r\n    beforeDelete() {}\r\n\r\n    insert(start, value) {\r\n        const historyItem = { type: 'insert', value, start }\r\n        this.history.push(historyItem)\r\n\r\n        this.beforeInsert(start, value)\r\n\r\n        let arr = Array.from(this.text)\r\n        arr.splice(start, 0, value)\r\n        this.text = arr.join('')\r\n\r\n        this.fireUpdate(historyItem)\r\n    }\r\n\r\n    replace(start, end, value) {\r\n        this.delete(start, end - start)\r\n        if (value) this.insert(start, value)\r\n    }\r\n\r\n    delete(start, n, dir = 'back') {\r\n        const historyItem = { type: 'delete', n, start, dir }\r\n        this.history.push(historyItem)\r\n\r\n        this.beforeDelete(start, n)\r\n\r\n        let arr = Array.from(this.text)\r\n        arr.splice(start, n)\r\n        this.text = arr.join('')\r\n\r\n        this.fireUpdate(historyItem)\r\n    }\r\n\r\n    listeners = {}\r\n\r\n    addEventListener(event, callback) {\r\n        if (this.listeners[event]) {\r\n            this.listeners[event].push(callback)\r\n        } else {\r\n            this.listeners[event] = [callback]\r\n        }\r\n    }\r\n\r\n    fireUpdate(...data) {\r\n        const callbacks = this.listeners['update']\r\n        if (!callbacks) return\r\n        callbacks.forEach(callback => callback(...data))\r\n    }\r\n\r\n    toHtml() {\r\n        if (!this.text.length) return '<div class=\"empty\">&#8203;</div>'\r\n        let allRanges = []\r\n        let nodes = []\r\n        let lines = [[]]\r\n        let result = ''\r\n\r\n        for (let styleName in this.styles) {\r\n            for (let range of this.styles[styleName].ranges) {\r\n                allRanges.push({ style: styleName, range })\r\n            }\r\n        }\r\n\r\n        const getStylesAtOffset = offset => {\r\n            return allRanges\r\n                .filter(rangeData => {\r\n                    let range = rangeData.range\r\n                    return range[0] <= offset && range[1] > offset\r\n                })\r\n                .map(rangeData => rangeData.style)\r\n        }\r\n\r\n        const stylesEqual = (a, b) => {\r\n            if (a.length !== b.length) return false\r\n            return !a.filter(el => b.indexOf(el) < 0).length\r\n        }\r\n\r\n        let currentNode = {\r\n            styles: getStylesAtOffset(0),\r\n            text: this.text[0],\r\n            start: 0,\r\n            end: 1\r\n        }\r\n        let currentLine = 0\r\n        for (let i = 1; i < this.text.length; i++) {\r\n            let ch = this.text[i]\r\n            let styles = getStylesAtOffset(i)\r\n\r\n            if (stylesEqual(currentNode.styles, styles) && ch !== '\\n') {\r\n                currentNode.end = i\r\n                currentNode.text += ch\r\n                continue\r\n            }\r\n\r\n            lines[currentLine].push(currentNode)\r\n            if (ch === '\\n') {\r\n                currentLine++\r\n                lines.push([])\r\n                // continue\r\n            }\r\n            currentNode = {\r\n                styles,\r\n                text: ch,\r\n                start: i,\r\n                end: i + 1\r\n            }\r\n        }\r\n        lines[currentLine].push(currentNode)\r\n\r\n        let x = 0\r\n        for (let nodes of lines) {\r\n            let lineText = ''\r\n            let lineLength = 0\r\n            for (let node of nodes) {\r\n                let start = node.styles\r\n                    .map(styleName => this.styles[styleName].openTag)\r\n                    .join('')\r\n                let end = node.styles\r\n                    .map(styleName => this.styles[styleName].closeTag)\r\n                    .join('')\r\n                lineText += start + node.text + end\r\n                if (node.text !== '\\n') lineLength += node.text.length\r\n            }\r\n            result += `${x ? '\\n' : ''}<div${\r\n                lineText === '\\n' ? ' class=\"empty\"' : ''\r\n            }>${\r\n                !lineLength ? '' : lineText.replace(/\\n/g, '') //.replace(/ /gm, '&nbsp;')\r\n            }</div>`\r\n            x++\r\n        }\r\n\r\n        return result\r\n    }\r\n}\r\n","class Editable extends HTMLElement {\r\n    connectedCallback() {\r\n        this.setAttribute('contenteditable', true)\r\n        this.addEventListener('click', () => this.focus())\r\n    }\r\n\r\n    initIO(io) {\r\n        let lastSelection\r\n\r\n        this.innerHTML = io.toHtml()\r\n\r\n        const insertText = (text, range) => {\r\n            if (range.collapsed) {\r\n                this.cursorPos = range.startOffset + text.length\r\n                io.insert(range.startOffset, text)\r\n            } else {\r\n                this.setCursorPos(range.startOffset + 1 + text.length)\r\n                io.replace(range.startOffset + 1, range.endOffset, text)\r\n            }\r\n\r\n            let styles = io.getStylesAtOffset(range.startOffset)\r\n            for (let styleName in this.stylesOverride) {\r\n                if (this.stylesOverride[styleName] && !(styleName in styles))\r\n                    io.mark(\r\n                        styleName,\r\n                        range.startOffset,\r\n                        range.startOffset + text.length\r\n                    )\r\n                if (!this.stylesOverride[styleName] && styleName in styles)\r\n                    io.unmark(\r\n                        styleName,\r\n                        range.startOffset,\r\n                        range.startOffset + text.length\r\n                    )\r\n            }\r\n            this.stylesOverride = {}\r\n        }\r\n\r\n        this.addEventListener('paste', e => {\r\n            e.preventDefault()\r\n            const clipboardData = e.clipboardData || window.clipboardData\r\n            const pastedData = clipboardData.getData('Text')\r\n            let range =\r\n                lastSelection && !lastSelection.collapsed\r\n                    ? lastSelection\r\n                    : this.getSelection()\r\n            insertText(pastedData, range)\r\n        })\r\n\r\n        this.addEventListener('input', e => {\r\n            if (e.inputType !== 'insertText') return\r\n\r\n            e.preventDefault()\r\n\r\n            let range =\r\n                lastSelection && !lastSelection.collapsed\r\n                    ? lastSelection\r\n                    : this.getSelection()\r\n            range.startOffset -= e.data.length\r\n\r\n            insertText(e.data, range)\r\n        })\r\n\r\n        this.addEventListener('input', e => {\r\n            if (e.inputType !== 'insertParagraph') return\r\n\r\n            let range = this.getSelection()\r\n\r\n            if (range.collapsed) {\r\n                this.cursorPos = range.startOffset\r\n                io.insert(range.startOffset, '\\n')\r\n                return\r\n            }\r\n\r\n            this.cursorPos = range.startOffset\r\n            io.replace(range.startOffset, range.endOffset, '\\n')\r\n        })\r\n\r\n        this.addEventListener('beforeinput', e => {\r\n            if (e.inputType !== 'deleteContentBackward') return\r\n\r\n            e.preventDefault()\r\n\r\n            let range = this.getSelection()\r\n            if (range.startOffset < 1 && range.collapsed) return\r\n\r\n            if (range.collapsed) {\r\n                this.cursorPos = range.startOffset - 1\r\n                io.delete(range.startOffset - 1, 1)\r\n                return\r\n            }\r\n            this.cursorPos = range.startOffset\r\n\r\n            io.delete(range.startOffset, range.endOffset - range.startOffset)\r\n        })\r\n\r\n        this.addEventListener('beforeinput', e => {\r\n            if (e.inputType !== 'deleteContentForward') return\r\n\r\n            e.preventDefault()\r\n\r\n            let range = this.getSelection()\r\n            this.cursorPos = range.startOffset\r\n\r\n            if (range.collapsed) {\r\n                io.delete(range.startOffset, 1, 'forward')\r\n                return\r\n            }\r\n            io.replace(range.startOffset, range.endOffset, '')\r\n        })\r\n\r\n        this.addEventListener('keydown', e => {\r\n            if (!e.ctrlKey || e.key !== 'Delete') return\r\n\r\n            e.preventDefault()\r\n\r\n            let text = io.text\r\n            let range = this.getSelection()\r\n\r\n            text = text.slice(range.startOffset, text.length)\r\n            let ch = io.text[range.startOffset]\r\n\r\n            let firstIndex\r\n            let regexp = ch.match(/\\s/) !== null ? /\\S/gm : /\\s/gm\r\n\r\n            let matches = Array.from(text.matchAll(regexp))\r\n\r\n            if (matches.length) firstIndex = matches[0].index\r\n            else firstIndex = text.length\r\n\r\n            io.delete(range.startOffset, firstIndex)\r\n            this.setCursorPos(range.startOffset)\r\n        })\r\n\r\n        this.addEventListener('keydown', e => {\r\n            if (!e.ctrlKey || e.key !== 'Backspace') return\r\n\r\n            e.preventDefault()\r\n\r\n            let text = io.text\r\n            let range = this.getSelection()\r\n\r\n            text = text.slice(0, range.startOffset)\r\n            let ch = io.text[range.startOffset - 1]\r\n\r\n            let firstIndex\r\n            let regexp = ch.match(/\\s/) !== null ? /\\S/gm : /\\s/gm\r\n\r\n            let matches = Array.from(text.matchAll(regexp))\r\n\r\n            if (matches.length)\r\n                firstIndex = matches[matches.length - 1].index + 1\r\n            else firstIndex = 0\r\n\r\n            this.setCursorPos(range.startOffset - text.length + firstIndex)\r\n            io.delete(\r\n                range.startOffset - text.length + firstIndex,\r\n                text.length - firstIndex\r\n            )\r\n        })\r\n\r\n        this.addEventListener('keyup', e => {\r\n            let navigationKeys = [\r\n                'ArrowLeft',\r\n                'ArrowRight',\r\n                'ArrowUp',\r\n                'ArrowDown',\r\n                'Home',\r\n                'End',\r\n                'PageUp',\r\n                'PageDown'\r\n            ]\r\n            if (navigationKeys.indexOf(e.key) < 0) return\r\n\r\n            this.cursorPos = this.getCursorPos()\r\n        })\r\n\r\n        this.addEventListener('mouseup', e => {\r\n            var range = window.getSelection().getRangeAt(0)\r\n            if (\r\n                range.startContainer.parentElement.classList.contains('empty')\r\n            ) {\r\n                this.setCursorPos(0, range.startContainer)\r\n            }\r\n            this.cursorPos = this.getCursorPos()\r\n        })\r\n    }\r\n\r\n    __cursorPos = 0\r\n    __cursorPosListeners = []\r\n    get cursorPos() {\r\n        return this.__cursorPos\r\n    }\r\n    set cursorPos(val) {\r\n        this.__cursorPos = val\r\n        this.__cursorPosListeners.forEach(cb => setTimeout(() => cb(val), 1))\r\n    }\r\n\r\n    addCursorPosListener(cb) {\r\n        this.__cursorPosListeners.push(cb)\r\n    }\r\n\r\n    getContainerOffset(container) {\r\n        let nodes = Array.from(this.childNodes)\r\n        while (nodes.filter(node => node.childNodes.length).length) {\r\n            nodes = nodes\r\n                .map(el =>\r\n                    el.nodeName === '#text' || el.nodeName === 'BR'\r\n                        ? [el]\r\n                        : Array.from(el.childNodes)\r\n                )\r\n                .flat(Infinity)\r\n        }\r\n\r\n        let offset = 0\r\n        for (let node of nodes) {\r\n            if (node === container) break\r\n            offset += node.length || 1\r\n        }\r\n\r\n        return offset\r\n    }\r\n\r\n    getContainerAtOffset(offset) {\r\n        let nodes = Array.from(this.childNodes)\r\n        while (nodes.filter(node => node.childNodes.length).length) {\r\n            nodes = nodes\r\n                .map(el =>\r\n                    el.nodeName === '#text' || el.nodeName === 'BR'\r\n                        ? [el]\r\n                        : Array.from(el.childNodes)\r\n                )\r\n                .flat(Infinity)\r\n        }\r\n\r\n        let lastNode\r\n        let x = 0\r\n        for (let node of nodes) {\r\n            if (node.nodeName == 'BR') {\r\n                x += 1\r\n                continue\r\n            }\r\n            if (node.nodeName !== '#text') {\r\n                if (!node.firstChild) continue\r\n                node = node.firstChild\r\n            }\r\n            lastNode = node\r\n            if (x + (node.length || 1) >= offset) break\r\n            x += node.length || 1\r\n        }\r\n        return { line: lastNode || nodes[0], n: x }\r\n    }\r\n\r\n    setCursorPos(offset) {\r\n        let containerData = this.getContainerAtOffset(offset)\r\n        let node = containerData.line\r\n        let n = containerData.n\r\n\r\n        if (!node) return\r\n\r\n        if (node.firstChild) node = node.firstChild\r\n\r\n        var range = window.getSelection().getRangeAt(0)\r\n        range.setEnd(node, offset - n)\r\n        range.setStart(node, offset - n)\r\n        this.cursorPos = offset\r\n    }\r\n\r\n    getCursorPos() {\r\n        var caretOffset = 0\r\n        var range = window.getSelection().getRangeAt(0)\r\n        var selected = range.toString().length\r\n        var preCaretRange = range.cloneRange()\r\n\r\n        preCaretRange.selectNodeContents(this)\r\n        preCaretRange.setEnd(range.endContainer, range.endOffset)\r\n        caretOffset = preCaretRange.toString().length - selected\r\n\r\n        const brCount = Array.from(preCaretRange.cloneContents().childNodes)\r\n            .map(el =>\r\n                el.nodeName === '#text'\r\n                    ? []\r\n                    : Array.from(el.querySelectorAll('*'))\r\n            )\r\n            .flat(Infinity)\r\n            .filter(el => el.nodeName === 'BR').length\r\n        caretOffset += brCount\r\n\r\n        return caretOffset\r\n    }\r\n\r\n    getSelection() {\r\n        let range = window.getSelection().getRangeAt(0)\r\n        let result = {}\r\n        let firstOffset = this.getContainerOffset(range.startContainer)\r\n        let secondOffset = this.getContainerOffset(range.endContainer)\r\n\r\n        result.toString = () => range.toString()\r\n\r\n        result.collapsed = range.collapsed\r\n\r\n        result.startContainer = range.startContainer\r\n        result.startOffset = range.startOffset + firstOffset\r\n\r\n        result.endContainer = range.endContainer\r\n        result.endOffset = range.endOffset + secondOffset\r\n\r\n        return result\r\n    }\r\n}\r\n\r\ncustomElements.define('baka-editable', Editable)\r\n","import Document from './markdown_document'\r\nimport Editable from './editable'\r\n\r\nclass BakaEditor extends HTMLElement {\r\n    template = `<div id=\"wrapper\">\r\n        <div id=\"buttons\">\r\n            <a href=\"#\" id=\"bold\" class=\"\">B</a>\r\n            <a href=\"#\" id=\"italic\" class=\"\">I</a>\r\n            <a href=\"#\" id=\"strike\" class=\"\">S</a>\r\n            <a href=\"#\" id=\"underline\" class=\"\">U</a>\r\n            <a href=\"#\" id=\"monospace\" class=\"\">M</a>\r\n        </div>\r\n        <div id=\"placeholder\">Type: Echo!</div>\r\n        <baka-editable id=\"editor\" />\r\n    </div>`\r\n\r\n    elms = {}\r\n    stylesOverride = {}\r\n\r\n    static get observedAttributes() {\r\n        return ['placeholder']\r\n    }\r\n\r\n    attributeChangedCallback(name, oldValue, newValue) {\r\n        switch (name) {\r\n            case 'placeholder':\r\n                this.elms.placeholder.innerHTML = newValue\r\n                break\r\n            case 'output':\r\n                this.outputContainer = document.querySelector(\r\n                    this.getAttribute('output')\r\n                )\r\n                break\r\n        }\r\n    }\r\n\r\n    connectedCallback() {\r\n        this.innerHTML = this.template\r\n\r\n        this.outputContainer = document.querySelector(\r\n            this.getAttribute('output')\r\n        )\r\n\r\n        this.elms.wrapper = this.querySelector('#wrapper')\r\n        this.elms.editor = this.querySelector('#editor')\r\n\r\n        this.elms.placeholder = this.querySelector('#placeholder')\r\n        if (this.getAttribute('placeholder'))\r\n            this.elms.placeholder.innerHTML = this.getAttribute('placeholder')\r\n\r\n        this.document = new Document()\r\n        this.document.addEventListener('update', this.onTextUpdate.bind(this))\r\n        this.document.addEventListener('update', this.logger.bind(this))\r\n\r\n        this.initEditor()\r\n        this.initButtons()\r\n\r\n        this.logger({ type: 'INIT' })\r\n    }\r\n\r\n    updateButtons() {\r\n        let range = this.elms.editor.getSelection()\r\n        let offset = range.startOffset\r\n        const styles = range.collapsed\r\n            ? Object.keys(this.document.getStylesAtOffset(offset))\r\n            : this.document.getStylesAtRange(range.startOffset, range.endOffset)\r\n\r\n        for (let styleName in this.stylesOverride) {\r\n            if (\r\n                styles.indexOf(styleName) >= 0 &&\r\n                !this.stylesOverride[styleName]\r\n            ) {\r\n                styles.splice(styles.indexOf(styleName), 1)\r\n            }\r\n            if (\r\n                styles.indexOf(styleName) < 0 &&\r\n                this.stylesOverride[styleName]\r\n            ) {\r\n                styles.push(styleName)\r\n            }\r\n        }\r\n\r\n        this.elms.wrapper\r\n            .querySelectorAll('#buttons > a')\r\n            .forEach(el => el.classList.remove('active'))\r\n        styles.forEach(style => {\r\n            if (!(style in this.elms.buttons)) return\r\n            this.elms.buttons[style].classList.add('active')\r\n        })\r\n    }\r\n\r\n    initButtons() {\r\n        this.elms.editor.addCursorPosListener(() => {\r\n            this.stylesOverride = {}\r\n            this.updateButtons()\r\n        })\r\n        this.elms.buttons = {\r\n            wrapper: this.elms.wrapper.querySelector('#buttons'),\r\n            bold: this.elms.wrapper.querySelector('#buttons #bold'),\r\n            italic: this.elms.wrapper.querySelector('#buttons #italic'),\r\n            strike: this.elms.wrapper.querySelector('#buttons #strike'),\r\n            underline: this.elms.wrapper.querySelector('#buttons #underline'),\r\n            monospace: this.elms.wrapper.querySelector('#buttons #monospace')\r\n        }\r\n\r\n        const onButtonClick = (buttonName, e) => {\r\n            e.preventDefault()\r\n            this.elms.editor.focus()\r\n\r\n            const range = this.elms.editor.getSelection()\r\n            if (!range.collapsed) {\r\n                const styles = this.document.getStylesAtRange(\r\n                    range.startOffset,\r\n                    range.endOffset\r\n                )\r\n                if (styles.indexOf(buttonName) >= 0) {\r\n                    this.document.unmark(\r\n                        buttonName,\r\n                        range.startOffset,\r\n                        range.endOffset\r\n                    )\r\n                } else {\r\n                    this.document.mark(\r\n                        buttonName,\r\n                        range.startOffset,\r\n                        range.endOffset\r\n                    )\r\n                }\r\n                this.elms.editor.cursorPos = range.endOffset\r\n                this.elms.editor.setCursorPos(range.endOffset)\r\n                return\r\n            }\r\n\r\n            const button = this.elms.buttons[buttonName]\r\n            const isActive = button.classList.contains('active')\r\n\r\n            this.stylesOverride[buttonName] = !isActive\r\n\r\n            // this.elms.buttons[buttonName].classList.toggle('active')\r\n        }\r\n\r\n        for (let styleName in this.document.styles) {\r\n            if (!(styleName in this.elms.buttons)) continue\r\n            this.elms.buttons[styleName].addEventListener('click', e =>\r\n                onButtonClick(styleName, e)\r\n            )\r\n        }\r\n        window.document.addEventListener('click', e => {\r\n            this.updateButtons()\r\n        })\r\n    }\r\n\r\n    logger(historyEvent) {\r\n        if (!this.debug) return\r\n        console.log(\r\n            '\\n%cFired event %s\\n%c%s\\n%s\\n%c%s\\n%s%o\\n%s%o\\n',\r\n            ['font-weight: bold', 'margin-bottom: 6px'].join(';'),\r\n            historyEvent.type.toUpperCase(),\r\n            ['color: rgba(0,0,0,1)', 'padding-bottom: 6px'].join(';'),\r\n            this.document.text.slice(0, this.elms.editor.cursorPos) +\r\n                '][' +\r\n                this.document.text.slice(\r\n                    this.elms.editor.cursorPos,\r\n                    this.document.text.length\r\n                ),\r\n            this.document.toHtml(),\r\n            ['color: rgba(0,0,0,.9)', 'line-height: 1.4em'].join(';'),\r\n            `Document length: ${this.document.text.length}; Cursor position: ${this.elms.editor.cursorPos}`,\r\n            'Event details:',\r\n            historyEvent,\r\n            'Styles:',\r\n            this.document.styles\r\n        )\r\n    }\r\n\r\n    onTextUpdate() {\r\n        if (this.document.text.length) {\r\n            this.elms.placeholder.classList.add('invisible')\r\n        } else {\r\n            this.elms.placeholder.classList.remove('invisible')\r\n        }\r\n\r\n        const html = this.document.toHtml()\r\n        this.elms.editor.innerHTML = html\r\n        if (this.outputContainer) this.outputContainer.value = html\r\n\r\n        this.elms.editor.setCursorPos(this.elms.editor.cursorPos)\r\n    }\r\n\r\n    initEditor() {\r\n        if (this.document.text.length) {\r\n            this.elms.placeholder.classList.add('invisible')\r\n        } else {\r\n            this.elms.placeholder.classList.remove('invisible')\r\n        }\r\n\r\n        this.elms.editor.initIO(this.document)\r\n    }\r\n}\r\n\r\ncustomElements.define('baka-editor', BakaEditor)\r\n","import Document from './document'\r\n\r\nexport default class MarkdownDocument extends Document {\r\n    // text = '*Привет*, **мир**!\\n***Сегодня*** __я__ ~~делаю~~ `маркдаун`!'\r\n    get styles() {\r\n        let t = this.text\r\n        let ranges = {\r\n            bold: [],\r\n            italic: [],\r\n            underline: [],\r\n            strike: [],\r\n            monospace: [],\r\n            service: []\r\n        }\r\n\r\n        const process = (styleNames, regexp, n) => {\r\n            this.text.replace(regexp, (fullMatch, match, index) => {\r\n                let start = index + n\r\n                let end = index + fullMatch.length - n\r\n                console.log(match, start, end, fullMatch)\r\n                for (let styleName of styleNames) {\r\n                    ranges[styleName].push([start, end])\r\n                }\r\n                ranges.service.push([start - n, start])\r\n                ranges.service.push([end, end + n])\r\n                return match\r\n            })\r\n        }\r\n\r\n        process(\r\n            ['bold'],\r\n            /(?<!\\*|\\\\\\*)\\*{2,2}[^\\*\\n](.+?)[^*]\\*{2,2}(?!\\*|\\\\)/gm,\r\n            2\r\n        )\r\n        process(['italic'], /((?<!\\*|\\\\)\\*[^*\\n].+?[^*|\\\\]\\*(?!\\*))/gm, 1)\r\n        process(\r\n            ['bold', 'italic'],\r\n            /(?<!\\*|\\\\)\\*{3,3}[^*\\n](.+?)[^*|\\\\]\\*{3,3}(?!\\*)/gm,\r\n            3\r\n        )\r\n        process(['underline'], /__(.+?)__/gm, 2)\r\n        process(['strike'], /~~(.+?)~~/gm, 2)\r\n        process(['monospace'], /`([^`]*)`/, 1)\r\n\r\n        return {\r\n            bold: {\r\n                openTag: '<b>',\r\n                closeTag: '</b>',\r\n                ranges: ranges.bold\r\n            },\r\n            italic: {\r\n                openTag: '<i>',\r\n                closeTag: '</i>',\r\n                ranges: ranges.italic\r\n            },\r\n            underline: {\r\n                openTag: '<u>',\r\n                closeTag: '</u>',\r\n                ranges: ranges.underline\r\n            },\r\n            strike: {\r\n                openTag: '<s>',\r\n                closeTag: '</s>',\r\n                ranges: ranges.strike\r\n            },\r\n            monospace: {\r\n                openTag: '<span class=\"monospace\">',\r\n                closeTag: '</span>',\r\n                ranges: ranges.monospace\r\n            },\r\n            service: {\r\n                openTag: '<span class=\"service\">',\r\n                closeTag: '</span>',\r\n                ranges: ranges.service\r\n            }\r\n        }\r\n    }\r\n\r\n    getStylesAtOffset(offset) {\r\n        let styles = {}\r\n        for (let styleName in this.styles) {\r\n            for (let i = 0; i < this.styles[styleName].ranges.length; i++) {\r\n                let range = this.styles[styleName].ranges[i]\r\n                if (!(range[0] <= offset && range[1] >= offset)) continue\r\n                styles[styleName] = range\r\n            }\r\n        }\r\n        return styles\r\n    }\r\n\r\n    getStylesAtRange(start, end) {\r\n        let styles = []\r\n        for (let styleName in this.styles) {\r\n            for (let i = 0; i < this.styles[styleName].ranges.length; i++) {\r\n                let range = this.styles[styleName].ranges[i]\r\n                if (\r\n                    !(\r\n                        (\r\n                            (range[0] >= start && range[0] <= end) || // Начало в выделении\r\n                            (range[1] >= start && range[1] <= end) || // Конец в выделении\r\n                            (range[0] <= start && range[1] >= end)\r\n                        ) // Выделение между началом и концом\r\n                    )\r\n                )\r\n                    continue\r\n                styles.push(styleName)\r\n            }\r\n        }\r\n        return styles\r\n    }\r\n}\r\n"],"sourceRoot":""}