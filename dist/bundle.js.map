{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/document.js","webpack:///./src/editable.js","webpack:///./src/index.js"],"names":["Document","bold","openTag","closeTag","active","ranges","italic","strike","offset","styles","styleName","i","length","range","start","end","push","activeRange","fireUpdate","type","activeRanges","splice","value","historyItem","history","arr","Array","from","text","join","insert","n","dir","remove","console","log","event","callback","listeners","data","callbacks","forEach","allRanges","nodes","lines","result","style","getStylesAtOffset","filter","rangeData","map","stylesEqual","a","b","el","indexOf","currentNode","currentLine","ch","lineText","lineLength","node","Editable","setAttribute","cb","__cursorPosListeners","container","childNodes","nodeName","flat","Infinity","lastNode","x","firstChild","line","containerData","getContainerAtOffset","window","getSelection","getRangeAt","setEnd","setStart","caretOffset","selected","toString","preCaretRange","cloneRange","selectNodeContents","endContainer","endOffset","brCount","cloneContents","querySelectorAll","firstOffset","getContainerOffset","startContainer","secondOffset","collapsed","startOffset","__cursorPos","val","setTimeout","HTMLElement","customElements","define","BakaEditor","innerHTML","template","elms","wrapper","querySelector","editor","placeholder","document","addEventListener","onTextUpdate","bind","logger","initEditor","initButtons","addCursorPosListener","Object","keys","getStylesAtRange","stylesOverride","classList","buttons","add","updateButtons","onButtonClick","buttonName","e","preventDefault","focus","unmark","mark","cursorPos","setCursorPos","button","isActive","contains","historyEvent","toUpperCase","slice","toHtml","ignore","key","cP","getCursorPos","replace","parentElement"],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","export default class Document {\r\n    //    text = 'aabb\\nbbaa'\r\n    text = ''\r\n    history = []\r\n\r\n    styles = {\r\n        bold: {\r\n            openTag: '<b>',\r\n            closeTag: '</b>',\r\n            active: false,\r\n            // ranges: [[2, 7]]\r\n            ranges: []\r\n        },\r\n        italic: {\r\n            openTag: '<i>',\r\n            closeTag: '</i>',\r\n            // ranges: [[6, 8]]\r\n            ranges: []\r\n        },\r\n        strike: {\r\n            openTag: '<s>',\r\n            closeTag: '</s>',\r\n            // ranges: [[1, 4]]\r\n            ranges: []\r\n        }\r\n    }\r\n\r\n    getStylesAtOffset(offset) {\r\n        let styles = {}\r\n        for (let styleName in this.styles) {\r\n            for (let i = 0; i < this.styles[styleName].ranges.length; i++) {\r\n                let range = this.styles[styleName].ranges[i]\r\n                if (!(range[0] < offset && range[1] >= offset)) continue\r\n                styles[styleName] = range\r\n            }\r\n        }\r\n        return styles\r\n    }\r\n\r\n    getStylesAtRange(start, end) {\r\n        let styles = []\r\n        for (let styleName in this.styles) {\r\n            for (let i = 0; i < this.styles[styleName].ranges.length; i++) {\r\n                let range = this.styles[styleName].ranges[i]\r\n                if (\r\n                    !(\r\n                        (\r\n                            (range[0] >= start && range[0] < end) || // Начало в выделении\r\n                            (range[1] > start && range[1] <= end) || // Конец в выделении\r\n                            (range[0] <= start && range[1] >= end)\r\n                        ) // Выделение между началом и концом\r\n                    )\r\n                )\r\n                    continue\r\n                styles.push(styleName)\r\n            }\r\n        }\r\n        return styles\r\n    }\r\n\r\n    mark(styleName, start, end) {\r\n        let i\r\n        let activeRange\r\n\r\n        for (i = 0; i < this.styles[styleName].ranges.length; i++) {\r\n            let range = this.styles[styleName].ranges[i]\r\n            if (!(range[0] <= start && range[1] >= start)) continue\r\n            activeRange = range\r\n            break\r\n        }\r\n\r\n        if (!activeRange) {\r\n            this.styles[styleName].ranges.push([start, end])\r\n        } else if (activeRange[1] < end) {\r\n            this.styles[styleName].ranges[i][1] = end\r\n        }\r\n\r\n        this.fireUpdate({ type: 'mark' })\r\n    }\r\n\r\n    unmark(styleName, start, end) {\r\n        let activeRanges = []\r\n\r\n        for (let i = 0; i < this.styles[styleName].ranges.length; i++) {\r\n            let range = this.styles[styleName].ranges[i]\r\n            if (\r\n                !(\r\n                    (\r\n                        (range[0] >= start && range[0] <= end) || // Начало в выделении\r\n                        (range[1] >= start && range[1] <= end) || // Конец в выделении\r\n                        (range[0] <= start && range[1] >= end)\r\n                    ) // Выделение между началом и концом\r\n                )\r\n            )\r\n                continue\r\n            activeRanges.push(i)\r\n            break\r\n        }\r\n\r\n        for (let i of activeRanges) {\r\n            let range = this.styles[styleName].ranges[i]\r\n            if (range[0] >= start && range[0] <= end && range[1] > end) {\r\n                // Начало в выделении, конец нет\r\n                this.styles[styleName].ranges[i][0] = end\r\n            }\r\n\r\n            if (range[1] >= start && range[1] <= end && range[0] < start) {\r\n                // Конец в выделении, начало нет\r\n                this.styles[styleName].ranges[i][1] = start\r\n            }\r\n\r\n            if (range[0] >= start && range[1] <= end) {\r\n                this.styles[styleName].ranges.splice(i, 1)\r\n            }\r\n        }\r\n        this.fireUpdate({ type: 'mark' })\r\n    }\r\n\r\n    insert(start, value) {\r\n        const historyItem = { type: 'insert', value, start }\r\n        this.history.push(historyItem)\r\n\r\n        for (let styleName in this.styles) {\r\n            let ranges = this.styles[styleName].ranges\r\n            for (let i = 0; i < ranges.length; i++) {\r\n                let range = ranges[i]\r\n                if (range[0] >= start)\r\n                    this.styles[styleName].ranges[i][0] += value.length\r\n                if (range[1] >= start)\r\n                    this.styles[styleName].ranges[i][1] += value.length\r\n            }\r\n        }\r\n\r\n        let arr = Array.from(this.text)\r\n        arr.splice(start, 0, value)\r\n        this.text = arr.join('')\r\n\r\n        this.fireUpdate(historyItem)\r\n    }\r\n\r\n    replace(start, end, value) {\r\n        this.delete(start, end - start)\r\n        if (value) this.insert(start, value)\r\n    }\r\n\r\n    delete(start, n, dir = 'back') {\r\n        const historyItem = { type: 'delete', n, start, dir }\r\n        this.history.push(historyItem)\r\n\r\n        for (let styleName in this.styles) {\r\n            let ranges = this.styles[styleName].ranges\r\n            let remove = []\r\n            for (let i = 0; i < ranges.length; i++) {\r\n                let range = ranges[i]\r\n\r\n                if (range[0] > start + n) {\r\n                    console.log('Selection: After end')\r\n                    // Если после конца выделения - сдвинуть назад\r\n                    this.styles[styleName].ranges[i][0] -= n\r\n                    this.styles[styleName].ranges[i][1] -= n\r\n                    continue\r\n                }\r\n\r\n                if (range[0] >= start && range[1] <= start + n) {\r\n                    console.log('Selection: inside')\r\n                    // Если полностью внутри выделения - удалить\r\n                    remove.push(i)\r\n                    continue\r\n                }\r\n\r\n                if (range[0] > start && range[1] > start + n) {\r\n                    console.log('Selection: beginning inside, end outside')\r\n                    // Если начало внутри выделения, а конец снаружи\r\n                    this.styles[styleName].ranges[i][0] = start\r\n                    this.styles[styleName].ranges[i][1] = range[1] - n\r\n                    continue\r\n                }\r\n\r\n                if (\r\n                    range[0] < start &&\r\n                    range[1] > start &&\r\n                    range[1] < start + n\r\n                ) {\r\n                    console.log('Selection: beginning before, end inside')\r\n                    // Если начало до выделения, а конец внутри\r\n                    this.styles[styleName].ranges[i][1] = start\r\n                    continue\r\n                }\r\n\r\n                if (range[0] < start && range[1] >= start + n) {\r\n                    console.log('Selection: full inside')\r\n                    // Если выделение полностью внутри\r\n                    this.styles[styleName].ranges[i][1] = range[1] - n\r\n                    continue\r\n                }\r\n\r\n                if (\r\n                    this.text[this.styles[styleName].ranges[i][1] - 1] === '\\n'\r\n                ) {\r\n                    this.styles[styleName].ranges[i][1] -= 1\r\n                }\r\n            }\r\n            for (let i of remove) {\r\n                this.styles[styleName].ranges.splice(i, 1)\r\n            }\r\n        }\r\n\r\n        let arr = Array.from(this.text)\r\n        arr.splice(start, n)\r\n        this.text = arr.join('')\r\n\r\n        this.fireUpdate(historyItem)\r\n    }\r\n\r\n    listeners = {}\r\n\r\n    addEventListener(event, callback) {\r\n        if (this.listeners[event]) {\r\n            this.listeners[event].push(callback)\r\n        } else {\r\n            this.listeners[event] = [callback]\r\n        }\r\n    }\r\n\r\n    fireUpdate(...data) {\r\n        const callbacks = this.listeners['update']\r\n        if (!callbacks) return\r\n        callbacks.forEach(callback => callback(...data))\r\n    }\r\n\r\n    toHtml() {\r\n        if (!this.text.length) return ''\r\n        let allRanges = []\r\n        let nodes = []\r\n        let lines = [[]]\r\n        let result = ''\r\n\r\n        for (let styleName in this.styles) {\r\n            for (let range of this.styles[styleName].ranges) {\r\n                allRanges.push({ style: styleName, range })\r\n            }\r\n        }\r\n\r\n        const getStylesAtOffset = offset => {\r\n            return allRanges\r\n                .filter(rangeData => {\r\n                    let range = rangeData.range\r\n                    return range[0] <= offset && range[1] > offset\r\n                })\r\n                .map(rangeData => rangeData.style)\r\n        }\r\n\r\n        const stylesEqual = (a, b) => {\r\n            if (a.length !== b.length) return false\r\n            return !a.filter(el => b.indexOf(el) < 0).length\r\n        }\r\n\r\n        let currentNode = {\r\n            styles: getStylesAtOffset(0),\r\n            text: this.text[0],\r\n            start: 0,\r\n            end: 1\r\n        }\r\n        let currentLine = 0\r\n        for (let i = 1; i < this.text.length; i++) {\r\n            let ch = this.text[i]\r\n            let styles = getStylesAtOffset(i)\r\n\r\n            if (stylesEqual(currentNode.styles, styles) && ch !== '\\n') {\r\n                currentNode.end = i\r\n                currentNode.text += ch\r\n                continue\r\n            }\r\n\r\n            lines[currentLine].push(currentNode)\r\n            if (ch === '\\n') {\r\n                currentLine++\r\n                lines.push([])\r\n                // continue\r\n            }\r\n            currentNode = {\r\n                styles,\r\n                text: ch,\r\n                start: i,\r\n                end: i + 1\r\n            }\r\n        }\r\n        lines[currentLine].push(currentNode)\r\n\r\n        for (let nodes of lines) {\r\n            let lineText = ''\r\n            let lineLength = 0\r\n            for (let node of nodes) {\r\n                let start = node.styles\r\n                    .map(styleName => this.styles[styleName].openTag)\r\n                    .join('')\r\n                let end = node.styles\r\n                    .map(styleName => this.styles[styleName].closeTag)\r\n                    .join('')\r\n                lineText += start + node.text + end\r\n                if (node.text !== '\\n') lineLength += node.text.length\r\n            }\r\n            result += `<div${lineText === '\\n' ? ' class=\"empty\"' : ''}>${\r\n                !lineLength ? '&#8203;' : lineText\r\n            }</div>`\r\n        }\r\n\r\n        // result = result.replace(/\\n/gm, '<br/>')\r\n\r\n        // if (result.endsWith('<br/>')) result += '&nbsp;'\r\n\r\n        return result\r\n        // return this.text\r\n    }\r\n}\r\n","class Editable extends HTMLElement {\r\n    connectedCallback() {\r\n        this.setAttribute('contenteditable', true)\r\n    }\r\n\r\n    __cursorPos = 0\r\n    __cursorPosListeners = []\r\n    get cursorPos() {\r\n        return this.__cursorPos\r\n    }\r\n    set cursorPos(val) {\r\n        this.__cursorPos = val\r\n        this.__cursorPosListeners.forEach(cb => setTimeout(() => cb(val), 1))\r\n    }\r\n\r\n    addCursorPosListener(cb) {\r\n        this.__cursorPosListeners.push(cb)\r\n    }\r\n\r\n    getContainerOffset(container) {\r\n        let nodes = Array.from(this.childNodes)\r\n        while (nodes.filter(node => node.childNodes.length).length) {\r\n            nodes = nodes\r\n                .map(el =>\r\n                    el.nodeName === '#text' || el.nodeName === 'BR'\r\n                        ? [el]\r\n                        : Array.from(el.childNodes)\r\n                )\r\n                .flat(Infinity)\r\n        }\r\n\r\n        let offset = 0\r\n        for (let node of nodes) {\r\n            if (node === container) break\r\n            offset += node.length || 1\r\n        }\r\n\r\n        return offset\r\n    }\r\n\r\n    getContainerAtOffset(offset) {\r\n        let nodes = Array.from(this.childNodes)\r\n        while (nodes.filter(node => node.childNodes.length).length) {\r\n            nodes = nodes\r\n                .map(el =>\r\n                    el.nodeName === '#text' || el.nodeName === 'BR'\r\n                        ? [el]\r\n                        : Array.from(el.childNodes)\r\n                )\r\n                .flat(Infinity)\r\n        }\r\n\r\n        let lastNode\r\n        let x = 0\r\n        for (let node of nodes) {\r\n            if (node.nodeName == 'BR') {\r\n                x += 1\r\n                continue\r\n            }\r\n            if (node.nodeName !== '#text') {\r\n                if (!node.firstChild) continue\r\n                node = node.firstChild\r\n            }\r\n            lastNode = node\r\n            if (x + (node.length || 1) >= offset) break\r\n            x += node.length || 1\r\n        }\r\n        return { line: lastNode || nodes[0], n: x }\r\n    }\r\n\r\n    setCursorPos(offset) {\r\n        let containerData = this.getContainerAtOffset(offset)\r\n        let node = containerData.line\r\n        let n = containerData.n\r\n\r\n        if (!node) return\r\n\r\n        if (node.firstChild) node = node.firstChild\r\n\r\n        var range = window.getSelection().getRangeAt(0)\r\n        range.setEnd(node, offset - n)\r\n        range.setStart(node, offset - n)\r\n    }\r\n\r\n    getCursorPos() {\r\n        var caretOffset = 0\r\n        var range = window.getSelection().getRangeAt(0)\r\n        var selected = range.toString().length\r\n        var preCaretRange = range.cloneRange()\r\n\r\n        preCaretRange.selectNodeContents(this)\r\n        preCaretRange.setEnd(range.endContainer, range.endOffset)\r\n        caretOffset = preCaretRange.toString().length - selected\r\n\r\n        const brCount = Array.from(preCaretRange.cloneContents().childNodes)\r\n            .map(el =>\r\n                el.nodeName === '#text'\r\n                    ? []\r\n                    : Array.from(el.querySelectorAll('*'))\r\n            )\r\n            .flat(Infinity)\r\n            .filter(el => el.nodeName === 'BR').length\r\n        caretOffset += brCount\r\n\r\n        return caretOffset\r\n    }\r\n\r\n    getSelection() {\r\n        let range = window.getSelection().getRangeAt(0)\r\n        let result = {}\r\n        let firstOffset = this.getContainerOffset(range.startContainer)\r\n        let secondOffset = this.getContainerOffset(range.endContainer)\r\n\r\n        result.collapsed = range.collapsed\r\n\r\n        result.startContainer = range.startContainer\r\n        result.startOffset = range.startOffset + firstOffset\r\n\r\n        result.endContainer = range.endContainer\r\n        result.endOffset = range.endOffset + secondOffset\r\n\r\n        return result\r\n    }\r\n}\r\n\r\ncustomElements.define('baka-editable', Editable)\r\n","import Document from './document'\r\nimport Editable from './editable'\r\n\r\nclass BakaEditor extends HTMLElement {\r\n    template = `<div id=\"wrapper\">\r\n        <div id=\"buttons\">\r\n            <a href=\"#\" id=\"bold\" class=\"\">B</a>\r\n            <a href=\"#\" id=\"italic\" class=\"\">I</a>\r\n            <a href=\"#\" id=\"strike\" class=\"\">S</a>\r\n        </div>\r\n        <div id=\"placeholder\">Type something!</div>\r\n        <baka-editable id=\"editor\" />\r\n    </div>`\r\n\r\n    elms = {}\r\n    stylesOverride = {}\r\n\r\n    connectedCallback() {\r\n        this.innerHTML = this.template\r\n        this.elms.wrapper = this.querySelector('#wrapper')\r\n        this.elms.editor = this.querySelector('#editor')\r\n        this.elms.placeholder = this.querySelector('#placeholder')\r\n        this.document = new Document()\r\n        this.document.addEventListener('update', this.onTextUpdate.bind(this))\r\n        this.document.addEventListener('update', this.logger.bind(this))\r\n        this.initEditor()\r\n        this.initButtons()\r\n        this.elms.editor.addCursorPosListener(offset => {\r\n            console.log('Cursor position:', offset)\r\n        })\r\n        this.logger({ type: 'INIT' })\r\n    }\r\n\r\n    updateButtons() {\r\n        let range = this.elms.editor.getSelection()\r\n        let offset = range.startOffset\r\n        const styles = range.collapsed\r\n            ? Object.keys(this.document.getStylesAtOffset(offset))\r\n            : this.document.getStylesAtRange(range.startOffset, range.endOffset)\r\n        console.log('Styles before:', styles)\r\n        for (let styleName in this.stylesOverride) {\r\n            if (\r\n                styles.indexOf(styleName) >= 0 &&\r\n                !this.stylesOverride[styleName]\r\n            ) {\r\n                styles.splice(styles.indexOf(styleName), 1)\r\n            }\r\n            if (\r\n                styles.indexOf(styleName) < 0 &&\r\n                this.stylesOverride[styleName]\r\n            ) {\r\n                styles.push(styleName)\r\n            }\r\n        }\r\n        console.log('Styles after:', styles)\r\n\r\n        this.elms.wrapper\r\n            .querySelectorAll('#buttons > a')\r\n            .forEach(el => el.classList.remove('active'))\r\n        styles.forEach(style => {\r\n            this.elms.buttons[style].classList.add('active')\r\n        })\r\n    }\r\n\r\n    initButtons() {\r\n        this.elms.editor.addCursorPosListener(() => {\r\n            this.stylesOverride = {}\r\n            this.updateButtons()\r\n        })\r\n        this.elms.buttons = {\r\n            wrapper: this.elms.wrapper.querySelector('#buttons'),\r\n            bold: this.elms.wrapper.querySelector('#buttons #bold'),\r\n            italic: this.elms.wrapper.querySelector('#buttons #italic'),\r\n            strike: this.elms.wrapper.querySelector('#buttons #strike')\r\n        }\r\n\r\n        const onButtonClick = (buttonName, e) => {\r\n            e.preventDefault()\r\n            this.elms.editor.focus()\r\n\r\n            const range = this.elms.editor.getSelection()\r\n            if (!range.collapsed) {\r\n                const styles = this.document.getStylesAtRange(\r\n                    range.startOffset,\r\n                    range.endOffset\r\n                )\r\n                if (styles.indexOf(buttonName) >= 0) {\r\n                    this.document.unmark(\r\n                        buttonName,\r\n                        range.startOffset,\r\n                        range.endOffset\r\n                    )\r\n                } else {\r\n                    this.document.mark(\r\n                        buttonName,\r\n                        range.startOffset,\r\n                        range.endOffset\r\n                    )\r\n                }\r\n                this.elms.editor.cursorPos = range.endOffset\r\n                this.elms.editor.setCursorPos(range.endOffset)\r\n                return\r\n            }\r\n\r\n            const button = this.elms.buttons[buttonName]\r\n            const isActive = button.classList.contains('active')\r\n\r\n            this.stylesOverride[buttonName] = !isActive\r\n\r\n            // this.elms.buttons[buttonName].classList.toggle('active')\r\n        }\r\n\r\n        for (let styleName in this.document.styles) {\r\n            this.elms.buttons[styleName].addEventListener('click', e =>\r\n                onButtonClick(styleName, e)\r\n            )\r\n        }\r\n        window.document.addEventListener('click', e => {\r\n            this.updateButtons()\r\n        })\r\n    }\r\n\r\n    logger(historyEvent) {\r\n        console.log(\r\n            '\\n%cFired event %s\\n%c%s\\n%s\\n%c%s\\n%s%o\\n%s%o\\n',\r\n            ['font-weight: bold', 'margin-bottom: 6px'].join(';'),\r\n            historyEvent.type.toUpperCase(),\r\n            ['color: rgba(0,0,0,1)', 'padding-bottom: 6px'].join(';'),\r\n            this.document.text.slice(0, this.elms.editor.cursorPos) +\r\n                '][' +\r\n                this.document.text.slice(\r\n                    this.elms.editor.cursorPos,\r\n                    this.document.text.length\r\n                ),\r\n            this.document.toHtml(),\r\n            ['color: rgba(0,0,0,.9)', 'line-height: 1.4em'].join(';'),\r\n            `Document length: ${this.document.text.length}; Cursor position: ${this.elms.editor.cursorPos}`,\r\n            'Event details:',\r\n            historyEvent,\r\n            'Styles:',\r\n            this.document.styles\r\n        )\r\n    }\r\n\r\n    onTextUpdate(event) {\r\n        if (this.document.text.length) {\r\n            this.elms.placeholder.classList.add('invisible')\r\n        } else {\r\n            this.elms.placeholder.classList.remove('invisible')\r\n        }\r\n        this.elms.editor.innerHTML = this.document.toHtml()\r\n        this.elms.editor.setCursorPos(this.elms.editor.cursorPos)\r\n    }\r\n\r\n    initEditor() {\r\n        if (this.document.text.length) {\r\n            this.elms.placeholder.classList.add('invisible')\r\n        } else {\r\n            this.elms.placeholder.classList.remove('invisible')\r\n        }\r\n\r\n        this.elms.editor.innerHTML = this.document.toHtml()\r\n\r\n        let ignore = [\r\n            'ArrowLeft',\r\n            'ArrowRight',\r\n            'ArrowUp',\r\n            'ArrowDown',\r\n            'Home',\r\n            'End',\r\n            'PageUp',\r\n            'PageDown'\r\n        ]\r\n\r\n        this.elms.editor.addEventListener('keypress', e => {\r\n            e.preventDefault()\r\n            if (e.key.length !== 1) return\r\n\r\n            let range = this.elms.editor.getSelection()\r\n            if (range.collapsed) {\r\n                this.elms.editor.cursorPos += 1\r\n                let cP = this.elms.editor.getCursorPos()\r\n                this.document.insert(cP, e.key)\r\n            } else {\r\n                this.elms.editor.cursorPos = range.startOffset + e.key.length\r\n                this.document.replace(range.startOffset, range.endOffset, e.key)\r\n            }\r\n\r\n            let styles = this.document.getStylesAtOffset(range.startOffset)\r\n            console.log('STYLES', styles)\r\n            for (let styleName in this.stylesOverride) {\r\n                if (this.stylesOverride[styleName] && !(styleName in styles))\r\n                    this.document.mark(\r\n                        styleName,\r\n                        range.startOffset,\r\n                        range.startOffset + e.key.length\r\n                    )\r\n                if (!this.stylesOverride[styleName] && styleName in styles)\r\n                    this.document.unmark(\r\n                        styleName,\r\n                        range.startOffset,\r\n                        range.startOffset + e.key.length\r\n                    )\r\n            }\r\n            this.stylesOverride = {}\r\n        })\r\n\r\n        this.elms.editor.addEventListener('keydown', e => {\r\n            if (e.key.length === 1) return\r\n\r\n            if (ignore.indexOf(e.key) >= 0) {\r\n                setTimeout(() => {\r\n                    this.elms.editor.cursorPos = this.elms.editor.getCursorPos()\r\n                }, 1)\r\n                return\r\n            }\r\n\r\n            e.preventDefault()\r\n\r\n            let cP = this.elms.editor.getCursorPos()\r\n            let range = this.elms.editor.getSelection()\r\n\r\n            switch (e.key) {\r\n                case 'Enter':\r\n                    if (range.collapsed) {\r\n                        this.elms.editor.cursorPos += 1\r\n                        this.document.insert(cP, '\\n')\r\n                    } else {\r\n                        this.elms.editor.cursorPos += 1\r\n                        this.document.replace(\r\n                            range.startOffset,\r\n                            range.endOffset,\r\n                            '\\n'\r\n                        )\r\n                    }\r\n                    break\r\n                case 'Backspace':\r\n                    if (cP < 1) break\r\n                    if (range.collapsed) {\r\n                        this.elms.editor.cursorPos -= 1\r\n                        this.document.delete(cP - 1, 1)\r\n                    } else {\r\n                        this.elms.editor.cursorPos = range.startOffset\r\n                        this.document.replace(\r\n                            range.startOffset,\r\n                            range.endOffset,\r\n                            ''\r\n                        )\r\n                    }\r\n                    break\r\n                case 'Delete':\r\n                    if (range.collapsed) {\r\n                        this.document.delete(cP, 1, 'forward')\r\n                    } else {\r\n                        this.elms.editor.cursorPos = range.startOffset\r\n                        this.document.replace(\r\n                            range.startOffset,\r\n                            range.endOffset,\r\n                            ''\r\n                        )\r\n                    }\r\n            }\r\n        })\r\n\r\n        this.elms.editor.addEventListener('mouseup', e => {\r\n            var range = window.getSelection().getRangeAt(0)\r\n            if (\r\n                range.startContainer.parentElement.classList.contains('empty')\r\n            ) {\r\n                this.elms.editor.setCursorPos(0, range.startContainer)\r\n            }\r\n            this.elms.editor.cursorPos = this.elms.editor.getCursorPos()\r\n        })\r\n    }\r\n}\r\n\r\ncustomElements.define('baka-editor', BakaEditor)\r\n"],"sourceRoot":""}